## Продуктовые сущности (то есть объекты реальной решаемой задачи)

### Задача (расчёт)

Некое вычисление которое должно производиться на серевере, можно принять что есть заранее известный доступный набор "расчётов" (некоторых фукнций на сервере), который пользователь может выбрать

Расчёт принимает на вход файл, исполняется на сервере и генерирует результат в также  виде файла
Атрибуты конкретного объекта задачи:

* Название
* Постанвщик (пользователь)
* Тип задачи (конкретная функция, которая будет работать на сервере)
* входные данные в виде файла
	* тут именно данные, которые являются входными для выбранной и настроенной параметрами (сл. пункт) задаче
	* Пример - "построчная задача'
		* список однотипных строк для каждой из которых надо совершить "расчёт", обработку
		* все строки независимые и даже сли какие-то приводят к ошибокам - то в следующие могут быть обработаны
		* По сути задача не может быть не выполнена, если формат данных валидный, так как её цель - обработать список, пусть даже если каждая строчка приводит к ошибке
	* Пример - "Поэтапная обработка", "Пайплайн"
		* водные данные обрабатываются в несколько тяжеловесных этапов
		* результат предыдущего этапа - это входные данные для следующего
		* Задача может завершиться неудачно, если один из этапов проваливается
		* Этап может быть и один
* параметры задачи 
	* набор переменных, позволяющий настраивать, параметризовать задачу
	* например, приоритет
		* для начала можно сделать 2 - "обычный" и "высокий"
* выходные данные в виде файла
* статус задачи (см. сценарии жизненного цикла задач ниже)

###  Пользователь

Авторизованный посетитель сайта который может ставить задачи на обработку 

## Сценарий работы с сервисом от лица пользователя

0. Авторизация в web морде  сервиса (сайте)
1. Создание задачи
	* выбирает нужную из списка доступных задач (расчётов)
	* прикрепляет файл с входныим данныим для этого расчёnа
	* нвзначет значения параметрам задач
	* отправляет задачу в очередь обработки кнопкой "Создать"

2. Просмотр  своих поставленных задач
	* Видит основные атрибуты задачи
	* Есть ссылка на файл с входныим данными (доступная только  автору задачи)
	* Текущий статус задачи
	* Время уже ушедешее на обработку
	* Ссылка на файл результата/отчёта, если статус задачи подразумевает наличие некоего результата, возможно частичного 
	* Текущее место в очереди, если задача в очереди

3. Ручная приостановка своей задачи
	* Может выбрать свою работающую задачу из списка и приостановить её обработку
4. Отправка приостановленных задач обратно в очередь
5. Отменить задачу
	*  В этом случае резултаты удаляются с сервера
 
## Предполагаемые сценарии жизенного цикла задачи

### Состояния в которых может находиться задача

#### Подразумевают завершённось
* "Невреные входные данные"
* "Завершена"
* "Завершена по причине ошибки"
* "Отменена"

#### Подразумевают незавершённость

* "Ожидание в очереди"
* "В обработке"
* "Приостановлена"
	* тут надо подумать все ли задачи могут быть приостановлены с сохранением текущего состояния

### Сценарии
1. После получения задачи от пользователя она попадает в очередь, с учётом приоритета
	* Задача может быть отменена будучи в очереди
	* Задача удаляется из очереди
	* статус "Отменена"
2. Согласно очереди в своё время задача поступает обработчику
	* обработчик валидирует входные данные
		* в случаче неуспеха задача получает статус "Неверные входные данные"
	* Приступает с обработке
		* задача получает статус "В обработке"
	* Может быть приостановлена пользователем
		* Задача дорабатывает до точки в которой можно сохранить её состояние
		* состояние сохраняется
			* напр. строчка во входном построчном файле до которой обработали
			* промежуточные результаты также записаны в файл и могут быть выданы
			* Статус переходит в "Приостановлена", задаче при этом не попадает в очередь
	* Вытеснена сервером обратно в очередь (см. раздел приоритезация)
		* аналогичное поведение как при приостановке
		* Задача получает статус "В очереди" и место согласно алгоритму приоритезации
	* Успешно завершается
		* Сохраняются файлы результата
		* Статус "Завершено"
	* Задаче на может быть продолжена
		* По какой либо причние задача не может продолжать выполняться
		* "Завершена по причине ошибки"
	* Задача может быть отменена в процессе обраотки
		* В этом случае даже не обязательно дожидатся точки в которой можно сохранить состояние
		* Файл результата не сохраняется
		* Статус "Отменена"
3. Вытесненная задача или приостановленная может быть взята в обработку
	* Единственное отличие от новой в том, что она должна быть "загружена" с того места где была остановлена в тот раз

### Свойства обработчиков

* Задачи на исполнение берёт набор обработчиков (англицизм - пул воркеров, woker pool)
* Величина набора обработчкиов (их количество) постоянно и является свойством сервера
* Обработчики могут исполнять все определённые в сервисе типы задач/расчётов


### Приоретизация

#### Список приоритетов
2 базовых приоритета для простоты и одна рабочая надстройка, далее в порядке возрастания
* Обычный
* Вытесненный сервером обычный
* Высокий

#### Свойства приоретизации

* задачи высокго приоритета не вытесняются
* среди задач обычного приоритета и вытесненных задач важнее та, что была поставлена (или вытеснена) раньше других
* Если следующая в очереди задача высокго приоритета и среди исполняемых задач есть обычные - то одна из обычных вытесняется обратно в очередь 

